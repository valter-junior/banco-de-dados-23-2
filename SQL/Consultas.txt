/*
CONSULTAS DO BANCO DE DADOS
*/

-- GROUP BY/ HAVING (+ JOIN)
SELECT A.NOME, COUNT(*)
FROM AUTOR A
INNER JOIN ESCREVE E ON A.MAT = E.MAT
GROUP BY A.NOME
HAVING COUNT(*) > 1;

-- JUNÇÃO INTERNA
SELECT A.NOME, L.TITULO
FROM AUTOR A
INNER JOIN ESCREVE E ON A.MAT = E.MAT
INNER JOIN LIVRO L ON E.ISBN = L.ISBN;

-- JUNÇÃO EXTERNA
SELECT A.NOME, L.TITULO
FROM AUTOR A
LEFT OUTER JOIN ESCREVE E ON A.MAT = E.MAT
LEFT OUTER JOIN LIVRO L ON E.ISBN = L.ISBN;

-- -- SEMI JUNÇÃO
 SELECT L.TITULO
 FROM LIVRO L 
 WHERE EXISTS (
     SELECT *
     FROM COMPRA C 
     WHERE C.ISBN = L.ISBN AND
	COD_DESC IS NOT NULL
);

-- USANDO “IN”
SELECT L.TITULO
FROM LIVRO L
WHERE L.ISBN IN (
    SELECT C.ISBN 
    FROM COMPRA C 
    WHERE C.COD_DESC IS NOT NULL
);

--ANTI-JUNÇÃO
SELECT DISTINCT G.GENERO
FROM GENERO G
WHERE NOT EXISTS (
    SELECT C.ISBN
    FROM COMPRA C 
    WHERE C.COD_DESC IS NOT NULL AND
    C.ISBN = G.ISBN
    );

-- SUBCONSULTA ESCALAR
SELECT COUNT(*) AS VENDA
FROM COMPRA 
GROUP BY CPF_FUNC
HAVING COUNT(*) = (
    SELECT MIN(VENDA)
    FROM (
        SELECT COUNT(*) AS VENDA, CPF_FUNC
        FROM COMPRA 
        GROUP BY CPF_FUNC
    )
);

-- SUBCONSULTA LINHA
SELECT COUNT(*) AS VENDA, F.NOME
FROM COMPRA C INNER JOIN FUNCIONARIO F
    ON C.CPF_FUNC = F.CPF
GROUP BY C.CPF_FUNC, F.NOME
HAVING COUNT(*) = (
    SELECT MIN(VENDA)
    FROM (
        SELECT COUNT(*) AS VENDA, CPF_FUNC
        FROM COMPRA 
        GROUP BY CPF_FUNC
    )
);

-- SUBCONSULTA TABELA
SELECT L.TITULO
FROM LIVRO L
WHERE L.ISBN IN (
    SELECT E.ISBN 
    FROM ESCREVE E 
    INNER JOIN AUTOR A ON E.MAT = A.MAT
    WHERE A.NACIONALIDADE = 'Brasileira'
);

-- OPERAÇÃO DE CONJUNTO (UNION)
SELECT NOME, CPF AS "CPF/CNPJ"
FROM PESSOAFISICA
UNION
SELECT RAZAO_SOCIAL, CNPJ 
FROM PESSOAJURIDICA;
