/*

CRIANDO TABELAS

*/

-- LIVRO
CREATE TABLE LIVRO (
   ISBN VARCHAR(13) NOT NULL,
   TITULO VARCHAR(100),
   CONSTRAINT PK_ISBN PRIMARY KEY (ISBN)
);

-- GÊNERO
CREATE TABLE GENERO (
   ISBN VARCHAR(13),
   GENERO VARCHAR(50),
   CONSTRAINT PK_GENERO PRIMARY KEY (ISBN, GENERO),
   CONSTRAINT FK_GENEROLIVRO FOREIGN KEY (ISBN) REFERENCES LIVRO (ISBN) ON DELETE CASCADE
   );

-- GRUPO
CREATE TABLE GRUPO (
    COD VARCHAR(4),
    CNPJ VARCHAR(14),
    CONSTRAINT PK_GRUPO PRIMARY KEY (COD)
);

-- LIVRARIA
CREATE TABLE LIVRARIA (
    COD VARCHAR(4),
    NUM VARCHAR(20),
    NOME VARCHAR(100),
    END_CEP VARCHAR(8),
    END_BAIRRO VARCHAR(100),
    END_RUA VARCHAR(100),
    END_NUM VARCHAR(10),
    CONSTRAINT PK_LIVRARIA PRIMARY KEY (COD, NUM),
    CONSTRAINT FK_CODGRUPO FOREIGN KEY (COD) REFERENCES GRUPO(COD) ON DELETE CASCADE
);


-- FUNCIONÁRIO
CREATE TABLE FUNCIONARIO (
   CPF VARCHAR(11),
   NOME VARCHAR(100),
   CPF_CHEFE VARCHAR(11),
   NUM_LIVRARIA VARCHAR(20),
   COD_LIVRARIA VARCHAR(4),
   CONSTRAINT PK_FUNCIONARIO PRIMARY KEY (CPF),
   CONSTRAINT FK_CPF_CHEFE FOREIGN KEY (CPF_CHEFE) REFERENCES FUNCIONARIO (CPF),
   CONSTRAINT FK_CODNUMLIVRARIA FOREIGN KEY (NUM_LIVRARIA, COD_LIVRARIA) REFERENCES LIVRARIA(NUM, COD)
);

-- CLIENTE 
CREATE TABLE CLIENTE (
    ID_CLIENTE VARCHAR(10),
    END_CEP VARCHAR(8),
    END_RUA VARCHAR(100),
    CONSTRAINT PK_CLIENTE PRIMARY KEY (ID_CLIENTE)
);

-- EMAILS-CLIENTE
CREATE TABLE EMAIL (
    ID_CLIENTE VARCHAR(10),
    EMAIL VARCHAR(100),
    CONSTRAINT FK_CLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE),
    CONSTRAINT PK_EMAILCLIENTE PRIMARY KEY (ID_CLIENTE, EMAIL)
);

-- CARTÃO 
CREATE TABLE CARTAO (
    NUM VARCHAR(16),
    ID_CLIENTE VARCHAR(10),
    CONSTRAINT FK_CLIENTECARTAO FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE),
    CONSTRAINT PK_CARTAO PRIMARY KEY (NUM, ID_CLIENTE)
    
);

-- DESCONTO 
CREATE TABLE DESCONTO (
    COD_DESC VARCHAR(6),
    VALOR INT CHECK (valor >= 0 AND valor <= 100),
    CONSTRAINT PK_DESCONTO PRIMARY KEY (COD_DESC)
);

-- AUTOR
CREATE TABLE AUTOR (
    MAT VARCHAR(10),
    NOME VARCHAR(100),
    NACIONALIDADE VARCHAR(40),
    CONSTRAINT PK_AUTOR PRIMARY KEY (MAT)
);

-- CLIENTE PJ
CREATE TABLE PESSOAJURIDICA (
    ID_CLIENTE VARCHAR(10),
    CNPJ VARCHAR(20),
    RAZAO_SOCIAL VARCHAR(100),
    CONSTRAINT PK_CLIENTE_PJ PRIMARY KEY (ID_CLIENTE),
    CONSTRAINT FK_CLIENTEPJID FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE)
);

-- CLIENTE PF
CREATE TABLE PESSOAFISICA (
    ID_CLIENTE VARCHAR(10),
    CPF VARCHAR(14),
    NOME VARCHAR(100),
    DATA_NASCIMENTO DATE,
    CONSTRAINT PK_CLIENTEPF PRIMARY KEY (ID_CLIENTE),
    CONSTRAINT FK_CLIENTEPFID FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE)
);

-- COMPRA
CREATE TABLE COMPRA (
    ID_CLIENTE VARCHAR(10) NOT NULL,
    CPF_FUNC VARCHAR(11) NOT NULL,
    ISBN VARCHAR(13) NOT NULL,
    DATA_COMPRA DATE NOT NULL,
    COD_DESC VARCHAR(6),
    CONSTRAINT FK_IDCLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE),
    CONSTRAINT FK_CPFFUNC FOREIGN KEY (CPF_FUNC) REFERENCES FUNCIONARIO(CPF),
    CONSTRAINT FK_LIVROISBN FOREIGN KEY (ISBN) REFERENCES LIVRO(ISBN),
    CONSTRAINT FK_CODDESC FOREIGN KEY (COD_DESC) REFERENCES DESCONTO(COD_DESC),
    CONSTRAINT PK_COMPRA PRIMARY KEY (ID_CLIENTE, CPF_FUNC, ISBN, DATA_COMPRA)
);

-- ESCREVE
CREATE TABLE ESCREVE (
ISBN VARCHAR(13),
MAT VARCHAR(10),
CONSTRAINT PK_ESCREVE PRIMARY KEY (ISBN, MAT),
CONSTRAINT FK_ISBNLIVRO FOREIGN KEY (ISBN) REFERENCES LIVRO(ISBN) ON DELETE CASCADE,
CONSTRAINT FK_MATAUTOR FOREIGN KEY (MAT) REFERENCES AUTOR(MAT) ON DELETE CASCADE
);
